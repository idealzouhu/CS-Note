### 单机事务的原子性实现

由于原子性的实现涉及到硬件和软件，单机事务主要**使用基于硬盘原子写和日志文件的方法实现原子性。**

**常见的机械磁盘一般可以保证 512 字节的原子写**，所谓原子写也就是说，即便遭遇突然断 电等意外情况，一般的机械磁盘也可以保证当前512字节的成功写入；如果写入的数据大于512 字节，则原子写得不到保障。

为了在更通用的情况下实现原子性，**单机事务使用日志或者 WAL 技术来实现原子性。 实际上就是将事务相关的信息写入持久化存储设备，以便后续能够回滚事务操作**



### 什么是原子提交协议

**分布式事务的原子性通过原子提交协议(Atomic Commit Protocol，ACP)来实现**，原子提交协议也叫原子提交算法。原子提交协议必须满足以下三个特性：

- **协定性**(Agreement)。所有进程都决议出同一个值,相当于所有进程要么一起提交事务，
  要么一起中止事务，不存在两个进程一个提交事务另一个中止事务的情况。
- **有效性**(Validity)。如果所有进程都决定提交事务并且没有任何故障发生，那么最终个系统将提交事务;只要有一个进程决定中止事务，系统最终将中止事务。
- **终止性**(Termination)。根据进程是否会有故障发生，终止性又分为弱终止条件(Weak Termination Condition)和强终止条件(Strong Termination Condition)。
  - 弱终止条件：如果没有任何故障发生，那么所有进程最终都会做出决议(提交或终止事务)。当故障发生时，事务将会阻塞，无法做出决议。
  - 强终止条件也称为非阻塞条件(Non-Blocking Condition)，是指没有发生故障的进程最终会做出决议。

原子提交协议实际上解决了分布式共识问题的一个子类，即对事务的提交或中止达成共识。我们可以通过原子提交协议中的两阶段提交更好地理解这一点。

> 由于分布式事务原子提交实际上是分布式共识问题的一个子类，共识算法可以用来尝试解决这个问题。



### 常见的原子提交协议

常见的原子提交协议有：

- 两阶段提交(Two-Phase Commit，2PC)
- 三阶段提交
- Paxos 提交算法
- 基于 Qurrum 的提交算法