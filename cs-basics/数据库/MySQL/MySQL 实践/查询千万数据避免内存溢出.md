举个例子，现在业务系统需要从 MySQL 数据库里读取 500w 数据行进行处理，应该怎么做：

1. 常规查询，一次性读取 500w 数据到 JVM 内存中，或者分页读取。
2. 流式查询，建立长连接，利用服务端游标，每次读取一条加载到 JVM 内存。
3. 游标查询，和流式一样，通过 fetchSize 参数，控制一次读取多少条数据。

| 查询方式 | 特点                                                         | 适用场景                                           |
| -------- | ------------------------------------------------------------ | -------------------------------------------------- |
| 常规查询 | 一次性返回所有结果，内存占用大，查询性能高但不适合大数据量   | 小数据量查询，快速获得所有查询结果                 |
| 流式查询 | 按需逐步返回数据，降低内存占用，保持数据库连接，适合海量数据 | 大数据量查询，逐步消费数据，例如日志处理、数据导出 |
| 游标查询 | 通过游标分批次处理数据，服务器端维护查询状态，灵活控制读取过程 | 大数据分页处理，逐行处理数据，复杂的查询场景       |



### 游标查询与流式查询的区别：

1. **概念区别**：
   - **游标查询**：是数据库提供的一种机制，允许客户端在执行查询时分批次处理数据。游标可以前后移动，并且由数据库服务器端维护查询的状态。
   - **流式查询**：是数据库在一次查询中逐行返回结果，而不是一次性返回所有数据，数据在客户端逐行处理，并保持与数据库的连接。
2. **实现方式**：
   - **游标查询**：游标创建后，客户端通过游标逐步获取数据，游标可以前后移动，甚至可以跳过某些行，或者从某个位置开始查询。游标在服务器端维护状态。
   - **流式查询**：在流式查询中，数据流一旦开始传输，客户端只能按照查询的顺序逐行读取数据，没有游标的灵活性。通常没有向前、跳过操作。
3. **使用场景**：
   - **游标查询**：适合需要灵活遍历数据的场景，例如分页、复杂的逐行处理、或者需要在结果集中进行前后移动的情况。
   - **流式查询**：适合海量数据逐行处理的场景，通常只需按顺序读取，而不需要频繁前后跳转，如日志处理、文件导出等。
4. **性能和资源**：
   - **游标查询**：由于在服务器端维护状态，游标占用服务器资源较多，因此对于长时间运行的操作，游标查询的开销会较大，需要合理使用。
   - **流式查询**：流式查询在资源占用上相对较低，因为它更关注逐行处理数据，适合处理超大数据集，但不需要复杂的查询状态管理。







### 参考资料

[查询千万数据避免内存溢出 (yuque.com)](https://www.yuque.com/magestack/12306/tfvph41m9b6k0grz#0d73b13a)