## 一、Linux文件系统

### 1.1 一切皆是文件

在Linux中，所有系统资源、硬件设备以及用户空间和内核空间之间的通信，都通过文件系统接口进行。这一思想的核心理念包括：

1. **文件抽象：** Linux **将所有资源都抽象为文件**，这包括硬件设备、网络接口、目录、进程等。每个文件都有一个在文件系统中的唯一路径。
2. **统一的接口：** 无论是读取一个文本文件、访问硬盘驱动器、与网络通信还是操作其他设备，都使用相似的文件操作接口。这种一致性简化了用户和程序对系统资源的访问方式。
3. **文件描述符：** 打开文件时，系统会返回一个称为文件描述符的整数值。这个文件描述符是进程与文件之间通信的主要手段，包括标准输入（stdin）、标准输出（stdout）和标准错误（stderr）。
4. **虚拟文件系统：** Linux的文件系统是虚拟的，它将底层的文件系统和设备抽象为一个统一的层次结构。这允许用户和应用程序在不关心底层细节的情况下访问文件。



### 1.2 Linux 文件系统简介





### 1.3 文件类型

在Linux系统中，文件类型通过文件的属性和权限来确定。以下是常见的Linux文件类型：

| 文件类型             | 表示符 | 描述                                   |
| -------------------- | ------ | -------------------------------------- |
| 普通文件             | `-`    | 包含了文本、二进制数据等内容的标准文件 |
| 目录文件             | `d`    | 用于存储其他文件和目录的容器           |
| 符号链接             | `l`    | 指向另一个文件或目录的快捷方式         |
| 设备文件（块设备）   | `b`    | 用于与系统硬件设备进行交互，如磁盘     |
| 设备文件（字符设备） | `c`    | 用于与系统硬件设备进行交互，如终端     |
| 套接字文件           | `s`    | 用于进程间通信的文件                   |
| 管道文件（FIFO）     | `p`    | 用于进程间通信的文件，也称为FIFO       |



## 二、Linux 目录结构

### 2.1  Linux 目录树

Linux的文件系统采用了类Unix的目录结构，主要遵循 **Filesystem Hierarchy Standard（FHS）规范**。

以下是一个典型的Linux文件目录树的主要部分：

```
/
|-- bin: 可执行二进制文件的存放目录
|-- boot: 引导加载程序和内核文件的存放目录，与开机有关
|-- dev: 设备文件目录，包含设备文件，例如终端、硬盘分区等
|-- etc: 配置文件目录，包含系统和应用程序的配置文件
|-- home: 系统默认的用户主目录的父目录，每个用户在此目录下有一个独立的子目录，例如 /home/user
|-- lib: 系统库文件的存放目录
|-- media: 可移动媒体设备（如CD-ROM、USB驱动器）的挂载点
|-- mnt: 空目录，通常用于挂载临时文件系统
|-- opt: 可选软件包安装目录
|-- proc: 进程信息和内核参数的虚拟文件系统目录
|-- root: 超级用户（root）的主目录
|-- run: 一些系统运行时需要写入的运行时数据，比如PID文件
|-- sbin: 系统管理员用于系统恢复和维护的系统二进制文件
|-- srv: 服务数据目录，存放一些服务启动之后需要提取的数据
|-- sys: Linux内核的虚拟文件系统目录，包含了内核与硬件的一些信息
|-- tmp: 临时文件目录，所有用户都可以访问
|-- usr: 系统用户的家目录（unix software resource），与软件安装/执行有关
|   |-- bin: 用户可执行文件的存放目录
|   |-- lib: 用户的库文件的存放目录
|   |-- local: 本地软件安装目录
|   |-- sbin: 非系统管理员使用的系统二进制文件
|   |-- share: 共享数据目录，包含man手册、info文档等
|-- var: 经常变化的文件存放目录 （variable），与系统运行过程有关，包含了各种日志文件、缓存文件等，
    |-- cache: 应用程序缓存数据的存放目录
    |-- lib: 应用程序在运行过程中需要修改的文件的存放目录
    |-- log: 系统和应用程序日志文件的存放目录
    |-- spool: 存放一些服务的数据，如邮件服务的邮箱
    |-- tmp: 存放一些临时文件

```

>  更加具体的信息查看 [Filesystem Hierarchy Standard (linuxfoundation.org)](https://refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html) 或者 《鸟哥的Linux私房菜 基础学习篇》5.3 节

另外，其中  `/home/user`  可以用 `~` 表示





### 2.2 软件安装路径



- **系统包管理器安装的二进制文件**：通常位于 `/bin`、`/usr/bin`、`/sbin`、`/usr/sbin`。
- **手动编译或用户安装的二进制文件**：通常位于 `/usr/local/bin` 或 `~/.local/bin`。
- **第三方应用和非系统包管理器安装**：通常位于 `/opt`、`/snap`、`/var/lib/flatpak`。
- **虚拟环境和开发工具安装**：位于虚拟环境文件夹内，或在特定开发环境目录中，例如 `~/anaconda3`。



在 Linux 系统中，**`/opt`** 是一个标准化的系统目录，其名称来源于 **"optional"（可选）** 的缩写，专门用于安装**独立的第三方商业软件**或**大型自包含应用程序**。

- **存放不遵循系统默认目录结构的软件**： 某些商业软件（如 MATLAB、IntelliJ IDEA）或闭源程序会将自己的所有文件（二进制、库、资源）集中安装在 `/opt` 下的独立子目录中，避免与系统包管理器（如 `apt`、`yum`）管理的文件混用

- **便于集中管理**：每个软件在 `/opt` 下拥有自己的子目录（如 `/opt/google/chrome`），删除时直接移除整个目录即可，不会影响其他软件。





## 二、inode 介绍

### 2.1 什么是 inode

`inode`（Index Node的缩写）是Unix和类Unix文件系统中的一个概念，<font color="blue">**用于描述文件或目录的元数据**</font>。每个文件或目录在文件系统中都有一个相关联的inode，它存储了有关该文件或目录的重要信息，但**不包括文件的名称和实际数据**。

当你在文件系统中创建文件时，文件名会被添加到相应目录的数据块中，同时会创建一个新的 `inode` 来存储文件的元数据。然后将文件名与 `inode` 关联起来，文件名和 `inode` 号的映射关系由目录中的记录维护。**这种分离的设计提高了文件系统的效率和灵活性**。



总的来说，Linux文件除了包含原有数据内容外，还含有非常非常多的权限和属性，分别存储在：

- 文件的权限与相关属性记录在单个 inode
- 文件的实际内容存储在单个或多个 block 区块



### 2.2 inode数据结构

`inode` 包含了以下关键信息：

1. **文件类型：** 指示该inode关联的是文件、目录、符号链接等类型。
2. **文件权限：** 描述了文件或目录的读、写和执行权限。
3. **文件所有者和所属组：** 指示了文件或目录的所有者和所属组。
4. **文件大小：** 文件的实际大小，对于目录，它可能包含的文件数量。
5. **时间戳：** 包括文件的访问时间、修改时间和状态改变时间。
6. **链接计数：** 表示有多少个目录项指向该inode。当创建一个文件或目录时，链接计数初始化为1，每次创建硬链接都会增加计数。
7. **数据块的指针：** 存储实际文件数据的指针。这些指针指向文件数据块的物理位置。



我们可以使用 stat 命令查看某个文件的 inode 信息。

```
zouhu@ubuntu:~/Desktop/cover$ stat a.txt 
  File: a.txt
  Size: 664       	Blocks: 8          IO Block: 4096   regular file
Device: 805h/2053d	Inode: 4462628     Links: 1
Access: (0664/-rw-rw-r--)  Uid: ( 1000/   zouhu)   Gid: ( 1000/   zouhu)
Access: 2024-01-25 05:22:40.506745000 -0800
Modify: 2024-01-23 04:08:33.035149000 -0800
Change: 2024-01-25 05:22:48.138746250 -0800
 Birth: -

```

该文件的 inode 为 4462628。




